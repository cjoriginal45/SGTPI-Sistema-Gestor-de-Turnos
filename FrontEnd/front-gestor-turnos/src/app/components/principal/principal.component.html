<div class="main-container">
  <div class="modal" [class.active]="showModal()" (click)="cerrarModal()">
    <div class="modal-contenido" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>{{ modalTurno()?.estado === 'CONFIRMADO' ? 'Modificar Turno' : 'Asignar Turno' }}</h2>
        <span class="cerrar-modal" (click)="cerrarModal()">&times;</span>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="pacienteNombre">Paciente:</label>
          <input
            type="text"
            id="pacienteNombre"
            placeholder="Nombre y apellido del paciente"
            [value]="pacienteNombre()"
            (input)="pacienteNombre.set($any($event.target).value)"
          />
        </div>
        <div class="form-group">
          <label for="telefonoPaciente">Teléfono:</label>
          <input
            type="tel"
            id="telefonoPaciente"
            placeholder="Teléfono del paciente"
            [value]="telefonoPaciente()"
            (input)="telefonoPaciente.set($any($event.target).value)"
          />
        </div>
        <div class="form-group">
          <label for="emailPaciente">Email:</label> <input
            type="email"
            id="emailPaciente"
            placeholder="Email del paciente"
            [value]="emailPaciente()"
            (input)="emailPaciente.set($any($event.target).value)"
          />
        </div>
        <div class="form-group">
          <label for="duracionTurno">Duración:</label>
          <select
            id="duracionTurno"
            [value]="duracionTurno()"
            (change)="duracionTurno.set(+$any($event.target).value)"
          >
            <option value="30">30 minutos</option>
            <option value="50">50 minutos</option>
            <option value="60">60 minutos</option>
          </select>
        </div>
        <div class="form-group">
          <label for="observaciones">Observaciones:</label>
          <textarea
            id="observaciones"
            placeholder="Observaciones adicionales del turno"
            [value]="observaciones()"
            (input)="observaciones.set($any($event.target).value)"
          ></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button
          class="btn-confirmarModal"
          (click)="confirmarModal()"
          [disabled]="!pacienteNombre().trim()"
        >
          Confirmar
        </button>
        <button class="btn-cancelarModal" (click)="cancelarModal()">
          Cancelar
        </button>
      </div>
    </div>
  </div>

  <app-header></app-header>

  <main class="main">
    <div class="agenda-container">
      <app-calendar (dateSelected)="onDateSelected($event)"></app-calendar>
    </div>

    <div
      class="notification"
      [class.active]="notificacion()"
      [ngClass]="notificacion()?.tipo"
      *ngIf="notificacion()"
    >
      {{ notificacion()?.mensaje }}
      <span class="close-btn" (click)="limpiarNotificacion()">&times;</span>
    </div>

    <div class="actividades-container">
      <h3 class="titulo-actividades">{{ tituloAgenda() }}</h3>

      <div class="lista-horas">
        <div class="bloque-horas">
          <h4 class="periodo-dia">MAÑANA</h4>
          <div
            class="hora-actividad"
            *ngFor="let turno of turnosPorPeriodo().manana"
            [attr.data-estado]="turno.estado"
          >
            <span class="hora">{{ turno.hora }}</span>
            <div class="turno-izquierda">
              <span class="turno-info">
                <span class="material-symbols-outlined">{{ getIconoPorEstado(turno.estado) }}</span>
                Turno: {{ getTextoEstado(turno) | titlecase }}
              </span>
            </div>
            <div class="turno-centro" *ngIf="turno.estado === 'CONFIRMADO'">
              <span class="turno-info"
                >Teléfono: {{ turno.telefono || "-" }}</span
              >
              <span class="turno-info"
                >Email: {{ turno.email || "-" }}</span
              > <span class="turno-info"
                >Duración: {{ turno.duracion }}</span
              >
            </div>

            <div class="turno-derecha">
              <ng-container *ngIf="turno.estado === 'BLOQUEADO'">
                <button class="btn-turno btn-desbloquear" (click)="desbloquearHora(turno.id)">
                  <span class="material-symbols-outlined">lock_open</span>
                  Desbloquear
                </button>
              </ng-container>

              <ng-container *ngIf="turno.estado === 'DISPONIBLE'">
                <button class="btn-turno btn-bloquear" (click)="bloquearHora(turno.id)">
                  <span class="material-symbols-outlined">lock</span>
                  Bloquear
                </button>
                <button class="btn-turno btn-asignar" (click)="asignarTurno(turno)">
                  <span class="material-symbols-outlined">person_add</span>
                  Asignar
                </button>
              </ng-container>

              <ng-container *ngIf="turno.estado === 'CONFIRMADO'">
                <button class="btn-turno btn-modificar" (click)="modificarTurno(turno)">
                  <span class="material-symbols-outlined">edit</span>
                  Modificar
                </button>
                <button class="btn-turno btn-cancelar" (click)="cancelarTurno(turno.id)">
                  <span class="material-symbols-outlined">cancel</span>
                  Cancelar
                </button>
              </ng-container>
            </div>
          </div>
        </div>

        <div class="bloque-horas">
          <h4 class="periodo-dia">TARDE</h4>
          <div
            class="hora-actividad"
            *ngFor="let turno of turnosPorPeriodo().tarde"
            [attr.data-estado]="turno.estado"
          >
            <span class="hora">{{ turno.hora }}</span>
            <div class="turno-izquierda">
              <span class="turno-info">
                <span class="material-symbols-outlined">{{ getIconoPorEstado(turno.estado) }}</span>
                Turno: {{ getTextoEstado(turno) | titlecase }}
              </span>
            </div>
            <div class="turno-centro" *ngIf="turno.estado === 'CONFIRMADO'">
              <span class="turno-info"
                >Teléfono: {{ turno.telefono || "-" }}</span
              >
              <span class="turno-info"
                >Email: {{ turno.email || "-" }}</span
              > <span class="turno-info"
                >Duración: {{ turno.duracion }}</span
              >
            </div>

            <div class="turno-derecha">
              <ng-container *ngIf="turno.estado === 'BLOQUEADO'">
                <button class="btn-turno btn-desbloquear" (click)="desbloquearHora(turno.id)">
                  <span class="material-symbols-outlined">lock_open</span>
                  Desbloquear
                </button>
              </ng-container>

              <ng-container *ngIf="turno.estado === 'DISPONIBLE'">
                <button class="btn-turno btn-bloquear" (click)="bloquearHora(turno.id)">
                  <span class="material-symbols-outlined">lock</span>
                  Bloquear
                </button>
                <button class="btn-turno btn-asignar" (click)="asignarTurno(turno)">
                  <span class="material-symbols-outlined">person_add</span>
                  Asignar
                </button>
              </ng-container>

              <ng-container *ngIf="turno.estado === 'CONFIRMADO'">
                <button class="btn-turno btn-modificar" (click)="modificarTurno(turno)">
                  <span class="material-symbols-outlined">edit</span>
                  Modificar
                </button>
                <button class="btn-turno btn-cancelar" (click)="cancelarTurno(turno.id)">
                  <span class="material-symbols-outlined">cancel</span>
                  Cancelar
                </button>
              </ng-container>
            </div>
          </div>
        </div>

        <div class="bloque-horas">
          <h4 class="periodo-dia">NOCHE</h4>
          <div
            class="hora-actividad"
            *ngFor="let turno of turnosPorPeriodo().noche"
            [attr.data-estado]="turno.estado"
          >
            <span class="hora">{{ turno.hora }}</span>
            <div class="turno-izquierda">
              <span class="turno-info">
                <span class="material-symbols-outlined">{{ getIconoPorEstado(turno.estado) }}</span>
                Turno: {{ getTextoEstado(turno) | titlecase }}
              </span>
            </div>
            <div class="turno-centro" *ngIf="turno.estado === 'CONFIRMADO'">
              <span class="turno-info"
                >Teléfono: {{ turno.telefono || "-" }}</span
              >
              <span class="turno-info"
                >Email: {{ turno.email || "-" }}</span
              > <span class="turno-info"
                >Duración: {{ turno.duracion }}</span
              >
            </div>

            <div class="turno-derecha">
              <ng-container *ngIf="turno.estado === 'BLOQUEADO'">
                <button class="btn-turno btn-desbloquear" (click)="desbloquearHora(turno.id)">
                  <span class="material-symbols-outlined">lock_open</span>
                  Desbloquear
                </button>
              </ng-container>

              <ng-container *ngIf="turno.estado === 'DISPONIBLE'">
                <button class="btn-turno btn-bloquear" (click)="bloquearHora(turno.id)">
                  <span class="material-symbols-outlined">lock</span>
                  Bloquear
                </button>
                <button class="btn-turno btn-asignar" (click)="asignarTurno(turno)">
                  <span class="material-symbols-outlined">person_add</span>
                  Asignar
                </button>
              </ng-container>

              <ng-container *ngIf="turno.estado === 'CONFIRMADO'">
                <button class="btn-turno btn-modificar" (click)="modificarTurno(turno)">
                  <span class="material-symbols-outlined">edit</span>
                  Modificar
                </button>
                <button class="btn-turno btn-cancelar" (click)="cancelarTurno(turno.id)">
                  <span class="material-symbols-outlined">cancel</span>
                  Cancelar
                </button>
              </ng-container>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>